<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID Cases Pie Chart</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }

        .legend {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>COVID-19 Cases in Asia and Europe</h2>

        <div class="controls">
            <label><input type="radio" name="region" value="All" checked> All</label>
            <label><input type="radio" name="region" value="Asia"> Asia</label>
            <label><input type="radio" name="region" value="Europe"> Europe</label>
        </div>

        <svg id="chart" width="600" height="400"></svg>

        <div class="legend"></div>
    </div>

    <script>
        // Data for Asia and Europe
        const dataset = {
            Asia: [
                { country: "China", cases: 5000 },
                { country: "India", cases: 3000 },
                { country: "Japan", cases: 1500 },
                { country: "South Korea", cases: 1000 }
            ],
            Europe: [
                { country: "Germany", cases: 4000 },
                { country: "France", cases: 3500 },
                { country: "Italy", cases: 3000 },
                { country: "Spain", cases: 2500 }
            ]
        };

        // Combine Asia and Europe for 'All'
        dataset.All = [...dataset.Asia, ...dataset.Europe];

        const width = 600;
        const height = 400;
        const radius = Math.min(width, height) / 2 - 40;

        // Create pie layout
        const pie = d3.pie()
            .value(d => d.cases)
            .sort(null);

        const arc = d3.arc()
            .innerRadius(0)
            .outerRadius(radius);

        // Append SVG and create group for pie chart
        const svg = d3.select("#chart")
            .append("g")
            .attr("transform", `translate(${width / 2},${height / 2})`);

        const color = d3.scaleOrdinal(d3.schemeCategory10);

        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Draw the pie chart
        function drawPieChart(region) {
            const data = dataset[region];

            // Clear previous chart
            svg.selectAll("*").remove();

            // Generate pie slices
            const pieData = pie(data);

            // Create pie chart arcs
            const arcs = svg.selectAll("path")
                .data(pieData)
                .enter()
                .append("path")
                .attr("d", arc)
                .attr("fill", d => color(d.data.country))
                .attr("stroke", "white")
                .attr("stroke-width", "2px")
                .on("mouseover", function (event, d) {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr("opacity", 0.8);
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                    tooltip.html(`<strong>${d.data.country}</strong><br>Cases: ${d3.format(",")(d.data.cases)}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function () {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr("opacity", 1);
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            // Add legend
            const legend = d3.select(".legend");
            legend.html(""); // Clear previous legend

            const legendItems = legend.selectAll(".legend-item")
                .data(data)
                .enter()
                .append("div")
                .attr("class", "legend-item");

            legendItems.append("div")
                .attr("class", "legend-color")
                .style("background-color", d => color(d.country));

            legendItems.append("span")
                .text(d => d.country);
        }

        // Handle radio button change
        d3.selectAll("input[name='region']").on("change", function () {
            const selectedRegion = this.value;
            drawPieChart(selectedRegion);
        });

        // Initial render with All data
        drawPieChart("All");
    </script>
</body>
</html>
